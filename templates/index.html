<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Strength Meter - Skripsi</title>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
        }
        .container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
            width: 90%;
            max-width: 600px;
            text-align: center;
        }
        h1 { color: #0056b3; margin-top: 0; margin-bottom: 10px; }
        p.subtitle { color: #555; font-size: 1.1em; margin-bottom: 25px; }
        
        /* --- WRAPPER INPUT --- */
        .input-wrapper {
            position: relative;
            width: 95%;
            margin: 0 auto 15px auto;
            height: 48px;
        }
        
        #password-input {
            width: 100%;
            height: 100%;
            padding: 0 45px 0 15px;
            font-size: 1em;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
        }
        
        #toggle-password {
            position: absolute;
            right: 15px;
            top: 0;
            bottom: 0;
            margin: auto;
            display: flex;
            align-items: center; 
            justify-content: center;
            width: 30px; 
            height: 100%; 
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.3s;
            z-index: 10;
        }
        #toggle-password:hover { opacity: 1; }
        
        #toggle-password svg {
            width: 22px;
            height: 22px;
            fill: #666;
        }

        /* --- TOMBOL UTAMA (ANALISIS) --- */
        #analyze-button {
            width: 95%;
            padding: 12px 20px;
            font-size: 1.1em;
            font-weight: bold;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-bottom: 15px;
        }
        #analyze-button:hover { background-color: #0056b3; }
        #analyze-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* --- TOMBOL SEKUNDER (TANTANGAN) --- */
        #challenge-link {
            display: block;
            width: 95%;
            padding: 12px 20px;
            font-size: 1.1em;
            font-weight: bold;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            box-sizing: border-box;
            margin: 0 auto;
            transition: background-color 0.3s ease;
        }
        #challenge-link:hover { background-color: #218838; }
        
        /* --- AREA HASIL --- */
        #hasil-analisis {
            margin-top: 25px; text-align: left; min-height: 50px;
            border: none; padding: 0;
        }
        .strong { color: #2ECC40; font-weight: bold; }
        
        /* --- LAYOUT 2 KOLOM (HASIL) --- */
        .attack-section {
            background-color: #f9f9f9; border: 1px solid #ddd;
            border-radius: 8px; padding: 20px; margin-bottom: 15px;
        }
        .attack-title {
            color: #D8000C; font-weight: bold; font-size: 1.1em;
            margin-top: 0; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;
        }
        .attack-content { display: flex; flex-wrap: wrap; gap: 20px; }
        .attack-definition {
            flex: 1; min-width: 200px; font-size: 0.9em;
            font-weight: bold; color: #444; line-height: 1.5;
        }
        .attack-tips {
            flex: 1; min-width: 200px; background-color: #fff;
            border: 1px solid #eee; border-radius: 5px; padding: 15px; font-size: 0.9em;
        }
        .attack-tips strong { display: block; margin-bottom: 10px; }
        .attack-tips ul { font-weight: normal; margin: 0; padding-left: 20px; }
        .attack-tips li { margin-bottom: 8px; }

    </style>
</head>
<body>

    <div class="container">
        <h1>Password Strength Checker</h1>
        <p class="subtitle">Aplikasi Pengecek Kekuatan Password</p>
        
        <div class="input-wrapper">
            <input type="password" id="password-input" placeholder="Ketik password Anda di sini...">
            <span id="toggle-password" title="Tampilkan Password">
                </span>
        </div>
        
        <button id="analyze-button">Analisis</button>
        <a href="/tantangan" id="challenge-link">üéØ Masuk ke Mode Tantangan</a>
        
        <div id="hasil-analisis">
            <p style="color: #777;">Silakan masukkan kata sandi untuk dianalisis.</p>
        </div>
    </div>

    <script>
        // --- 1. DEFINISI VARIABEL GLOBAL ---
        const tombolAnalisis = document.getElementById("analyze-button");
        const inputPassword = document.getElementById("password-input");
        const togglePassword = document.getElementById("toggle-password");
        const divHasil = document.getElementById("hasil-analisis");

        // --- 2. LOGIKA ICON MATA (SVG) ---
        const iconEyeOpen = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>`;
        const iconEyeSlash = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.83 9L15 12.16V12a3 3 0 0 0-3-3h-.17zm-4.3.8l1.55 1.55c-.05.21-.08.42-.08.65a3 3 0 0 0 3 3c.22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53a5 5 0 0 1-5-5c0-.79.2-1.53.53-2.2zm-2.53 1.3c-.25.59-.46 1.2-.63 1.84-.15.56-.25 1.14-.29 1.73 1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42 1.57 1.27-1.27-16.9-16.9-1.27 1.27.98 3.62c-.65.4-1.25.87-1.78 1.4zm15.32-1.5c.37.65.68 1.33.91 2.05.15-.56.25-1.14.29-1.73-1.73-4.39-6-7.5-11-7.5-.31 0-.62.01-.92.04L12 4.8l2.46 2.46c1.92.57 3.52 1.87 4.32 3.66zM12 7c1.63 0 3.06.85 3.92 2.13l-5.8 5.8C9.29 14.27 8.5 13.22 8.5 12c0-1.93 1.57-3.5 3.5-3.5z"/></svg>`;

        // Set icon awal
        togglePassword.innerHTML = iconEyeOpen;

        togglePassword.addEventListener("click", function() {
            const type = inputPassword.getAttribute("type") === "password" ? "text" : "password";
            inputPassword.setAttribute("type", type);
            this.innerHTML = type === "text" ? iconEyeSlash : iconEyeOpen;
            this.setAttribute("title", type === "text" ? "Sembunyikan Password" : "Tampilkan Password");
        });

        // --- 3. KAMUS DEFINISI ---
        const attackDefinitions = {
            "BRUTEFORCE": "Serangan ini mencoba semua kemungkinan kombinasi karakter (a, b, c, 1, 2, 3, !, @, #) satu per satu. Semakin pendek dan sederhana kata sandi Anda, semakin cepat serangan ini berhasil.",
            "DICTIONARY": "Serangan ini menggunakan 'kamus' berisi jutaan kata sandi umum yang pernah bocor. Jika kata sandi Anda ada di daftar ini, kata sandi itu bisa langsung dijebol.",
            "HYBRID": "Serangan ini menggabungkan 'kata kamus' dengan pola umum (seperti angka atau simbol). Contoh: 'sayang123' atau 'password!'.",
        };

        const weaknessTips = {
            "BRUTEFORCE_LENGTH": "Tambahkan lebih banyak karakter (minimal 12+).",
            "BRUTEFORCE_NO_LOWER": "Gunakan setidaknya satu huruf kecil (a-z).",
            "BRUTEFORCE_NO_UPPER": "Gunakan setidaknya satu huruf besar (A-Z).",
            "BRUTEFORCE_NO_NUMBER": "Gunakan setidaknya satu angka (0-9).",
            "BRUTEFORCE_NO_SYMBOL": "Gunakan setidaknya satu simbol (!@#$%).",
            "BRUTEFORCE_REPEAT": "Jangan gunakan karakter berulang (misal: aaa).",
            "BRUTEFORCE_SEQUENCE": "Acak urutan karakter, jangan berurutan (misal: abc/123).",
            "BRUTEFORCE_KEYBOARD": "Lompat-lompatlah saat mengetik, jangan hanya geser tombol kesebelah saja (misal: qwerty).",
            "DICTIONARY_MATCH": "Ganti total. Kata sandi Anda ada di kamus kata sandi yang pernah bocor.",
            "HYBRID_MATCH": "Hindari pola 'kata' + 'angka'. Buat lebih acak.",
            "INVALID_INPUT": "Input tidak boleh kosong atau hanya berisi spasi."
        };

        // --- 4. FUNGSI FETCH (LOGIKA TOMBOL) ---
        tombolAnalisis.addEventListener("click", function() {
            const password = inputPassword.value;
            
            // Tampilkan efek loading
            divHasil.innerHTML = '<p>‚è≥ Sedang menganalisis...</p>';
            tombolAnalisis.disabled = true; // Matikan tombol sementara
            tombolAnalisis.textContent = "Memproses...";

            fetch("/analyze", { 
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ "password": password }) 
            })
            .then(response => response.json()) 
            .then(data => {
                // Nyalakan tombol lagi
                tombolAnalisis.disabled = false;
                tombolAnalisis.textContent = "Analisis";
                divHasil.innerHTML = ""; 

                if (data.isWeak) {
                    const bfTips = [];
                    const dictTips = [];
                    const hybTips = [];
                    const patternTips = [];
                    let hasInvalidInput = false;

                    data.weaknesses.forEach(key => {
                        const tip = weaknessTips[key] || "Tip tidak dikenal.";
                        if (key.startsWith("BRUTEFORCE_")) { bfTips.push(tip); } 
                        else if (key.startsWith("DICTIONARY_")) { dictTips.push(tip); } 
                        else if (key.startsWith("HYBRID_")) { hybTips.push(tip); }
                        else if (key.startsWith("PATTERN_")) { patternTips.push(tip); }
                        else if (key === "INVALID_INPUT") {
                            hasInvalidInput = true;
                            divHasil.innerHTML = `<p class="attack-title" style="text-align: center; color: #D8000C;">‚ö†Ô∏è ${tip}</p>`;
                        }
                    });

                    if (!hasInvalidInput) {
                        if (bfTips.length > 0) {
                            divHasil.innerHTML += renderSection("‚ùå Rentan terhadap Serangan Brute-Force", attackDefinitions.BRUTEFORCE, bfTips);
                        }
                        if (dictTips.length > 0) {
                            divHasil.innerHTML += renderSection("‚ùå Rentan terhadap Serangan Kamus (Dictionary)", attackDefinitions.DICTIONARY, dictTips);
                        }
                        if (hybTips.length > 0) {
                            divHasil.innerHTML += renderSection("‚ùå Rentan terhadap Serangan Hibrida (Hybrid)", attackDefinitions.HYBRID, hybTips);
                        }
                        if (patternTips.length > 0) {
                            divHasil.innerHTML += renderSection("‚ùå Pola Mudah Ditebak (Pattern Recognition)", attackDefinitions.PATTERN, patternTips);
                        }
                    }
                } else {
                    divHasil.innerHTML = '<h4>‚úÖ Selamat! Kata Sandi Anda Kuat.</h4><p class="strong">Kata sandi Anda tidak ditemukan di kamus dan memiliki kombinasi yang kompleks, sehingga sulit untuk ditebak.</p>';
                }
            })
            .catch(error => {
                console.error("Error:", error);
                tombolAnalisis.disabled = false;
                tombolAnalisis.textContent = "Analisis";
                divHasil.innerHTML = '<p class="attack-title">Error: Tidak dapat terhubung ke server analisis. Pastikan server Flask (app.py) berjalan.</p>';
            });
        });

        // Helper Function untuk membuat HTML section
        function renderSection(title, definition, tipsArray) {
            return `
            <div class="attack-section">
                <h4 class="attack-title">${title}</h4>
                <div class="attack-content">
                    <div class="attack-definition"><p>${definition}</p></div>
                    <div class="attack-tips">
                        <strong>Tips Perbaikan:</strong>
                        <ul>${tipsArray.map(t => `<li>${t}</li>`).join('')}</ul>
                    </div>
                </div>
            </div>`;
        }
    </script>
</body>
</html>